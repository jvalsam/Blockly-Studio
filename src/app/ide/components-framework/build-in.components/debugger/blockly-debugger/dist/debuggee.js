!function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},a.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=4)}([,function(e,t,a){"use strict";a.r(t),a.d(t,"window",function(){return n}),a.d(t,"Blockly_Debuggee",function(){return r}),a.d(t,"InitializeBlocklyDebuggee",function(){return o}),a.d(t,"dispatcher",function(){return c});var n={},r={actions:{}};function o(e){r.state={currNest:0,currId:"",promptMsg:void 0,alertFlag:!1,stepWait:!1,currState:{stepIn:!1,stepOver:!1,stepParent:!1,stepOut:!1,continue:!0},isState:function(e){return this.currState[e]},setState:function(e){this.currState.stepIn=!1,this.currState.stepOver=!1,this.currState.stepParent=!1,this.currState.stepOut=!1,this.currState.continue=!1,this.currState[e]=!0}},r.wait=function(){function e(){return e=0,new Promise(t=>setTimeout(t,e));var e}return async function(t,a,n){!function(e,t){postMessage({type:"highlightBlock",data:{id:e,currentSystemEditorId:t}})}(a,n);var o=r.actions.breakpoint.includes_enable(a)||r.actions.runToCursor.cursorBreakpoint===a;if(r.actions.runToCursor.cursorBreakpoint===a&&(r.actions.runToCursor.cursorBreakpoint=""),!r.state.isState("continue")||o){if((-1!=r.state.currNest||o)&&(r.state.isState("stepIn")||o||t<=r.state.currNest)){if(r.state.currId===a&&!o)return;if(r.state.isState("stepParent")&&t==r.state.currNest&&!o)return;for(r.actions.variables.updateDebugger(),r.actions.watch.updateDebugger(),r.actions.breakpoint.wait_view(a);!r.state.stepWait;)await e();r.actions.breakpoint.reset_view(a),r.state.stepWait=!1,r.state.currId=a,r.state.isState("stepOut")?(r.state.currNest=-1,r.state.currState.stepOut=!1):r.state.currNest=t}}else r.state.currNest=t}}(),r.function_return_decorator=function(e,t){return-1!=r.state.currNest&&(r.state.currState.parent=!1),r.state.currNest=t,e},n.alert=async function(e){for(r.actions.variables.updateDebugger(),r.actions.watch.updateDebugger(),setTimeout(function(){postMessage({type:"alert",data:e})},50);!r.state.alertFlag;)await new Promise(e=>setTimeout(e,0));r.state.alertFlag=!1},n.prompt=async function(e){for(r.actions.variables.updateDebugger(),r.actions.watch.updateDebugger(),setTimeout(function(){postMessage({type:"prompt",data:e})},50);void 0==r.state.promptMsg;)await new Promise(e=>setTimeout(e,0));var t=r.state.promptMsg;return r.state.promptMsg=void 0,t}}var c={prompt:e=>{r.state.promptMsg=e},alert:()=>{r.state.alertFlag=!0}}},,function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return BlocklyDebuggeeStartAction});var _init_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1),Blockly_Debuggee=__webpack_require__(1).Blockly_Debuggee,window=__webpack_require__(1).window;function update_values(){return Blockly_Debuggee.actions.variables.update_values()+Blockly_Debuggee.actions.watch.update_values()}function BlocklyDebuggeeStartAction(plugin){Blockly_Debuggee.actions.start_debugging=function(){async function handler(content){if(void 0!=content){Blockly_Debuggee.actions.breakpoint.update(content.breakpoints),Blockly_Debuggee.actions.runToCursor.cursorBreakpoint=content.cursorBreakpoint,Blockly_Debuggee.actions.watch.update(content.watches),Blockly_Debuggee.actions.variables.update(content.variables);var variables=Blockly_Debuggee.actions.variables.getVariables(),watches=Blockly_Debuggee.actions.watch.getWatches(),def_variables_code=Blockly_Debuggee.actions.variables.define_variables(),variablesWatches_code='eval(update_values()); Blockly_Debuggee.actions["variables"].updateDebugger(); Blockly_Debuggee.actions["watch"].updateDebugger();';await eval(def_variables_code+' function evalLocal(expr){eval(expr);} Blockly_Debuggee.actions["eval"].evalLocal = evalLocal;async function code(){ '+content.code+variablesWatches_code+"}; code(); "),postMessage({type:"execution_finished"})}else window.alert("The content is undefined.")}async function $id(e,t,a){return a}async function wait(e,t,a){await Blockly_Debuggee.wait(e,t,a)}function isStepOver(){return Blockly_Debuggee.state.isState("stepOver")}function isStepParent(){return Blockly_Debuggee.state.isState("stepParent")}return{handler:handler}}(),_init_js__WEBPACK_IMPORTED_MODULE_0__.dispatcher.start_debugging=Blockly_Debuggee.actions.start_debugging.handler}},function(e,t,a){"use strict";a.r(t);var n=a(1),r=a(3);function o(e){var t;Object(n.InitializeBlocklyDebuggee)(e),Object(r.a)(e),n.Blockly_Debuggee.actions.watch=function(){var e=[];function t(){postMessage({type:"watches",data:e})}return{handler:function(a){e=a;for(var r=0;r<e.length;++r)n.Blockly_Debuggee.actions.eval.evalLocal('var watches = Blockly_Debuggee.actions["watch"].getWatches();watches['+r+"].value = "+e[r].code+";\n");t()},includes:function(t){return e.includes(t)},update:function(t){e=t},update_values:function(){for(var t="",a=0;a<e.length;++a)t+="watches["+a+"].value = "+e[a].code+";\n";return'var watches = Blockly_Debuggee.actions["watch"].getWatches();'+t},getWatches:function(){return e},updateDebugger:t}}(),n.dispatcher.watch=n.Blockly_Debuggee.actions.watch.handler,n.Blockly_Debuggee.actions.variables=(t=[],{update:function(e){t=e},update_values:function(){for(var e="",a=0;a<t.length;++a)e+="variables["+a+"].value = "+t[a].name+";\n";return e},getVariables:function(){return t},updateDebugger:function(){postMessage({type:"variables",data:t})},define_variables:function(){for(var e="",a=0;a<t.length;++a)e+="var "+t[a].name+";\n";return e}}),n.Blockly_Debuggee.actions.eval.evalLocal,n.Blockly_Debuggee.actions.eval.handler=function(e){n.Blockly_Debuggee.actions.eval.evalLocal(e),n.Blockly_Debuggee.actions.eval.evalLocal(n.Blockly_Debuggee.actions.variables.update_values()),n.Blockly_Debuggee.actions.variables.updateDebugger(),n.Blockly_Debuggee.actions.eval.evalLocal(n.Blockly_Debuggee.actions.watch.update_values()),n.Blockly_Debuggee.actions.watch.updateDebugger()},n.dispatcher.eval=n.Blockly_Debuggee.actions.eval.handler,n.Blockly_Debuggee.actions.continue={},n.Blockly_Debuggee.actions.continue.handler=(()=>{n.Blockly_Debuggee.state.stepWait=!0,n.Blockly_Debuggee.state.setState("continue")}),n.dispatcher.continue=n.Blockly_Debuggee.actions.continue.handler,n.Blockly_Debuggee.actions.stepIn={},n.Blockly_Debuggee.actions.stepIn.handler=(()=>{n.Blockly_Debuggee.state.stepWait=!0,n.Blockly_Debuggee.state.setState("stepIn")}),n.dispatcher.stepIn=n.Blockly_Debuggee.actions.stepIn.handler,n.Blockly_Debuggee.actions.stepOver={},n.Blockly_Debuggee.actions.stepOver.handler=(()=>{n.Blockly_Debuggee.state.stepWait=!0,n.Blockly_Debuggee.state.setState("stepOver")}),n.dispatcher.stepOver=n.Blockly_Debuggee.actions.stepOver.handler,n.Blockly_Debuggee.actions.stepOut={},n.Blockly_Debuggee.actions.stepOut.handler=(()=>{n.Blockly_Debuggee.state.stepWait=!0,n.Blockly_Debuggee.state.setState("stepOut")}),n.dispatcher.stepOut=n.Blockly_Debuggee.actions.stepOut.handler,n.Blockly_Debuggee.actions.stepParent={},n.Blockly_Debuggee.actions.stepParent.handler=(()=>{n.Blockly_Debuggee.state.stepWait=!0,n.Blockly_Debuggee.state.setState("stepParent")}),n.dispatcher.stepParent=n.Blockly_Debuggee.actions.stepParent.handler,n.Blockly_Debuggee.actions.breakpoint=function(){var e=[];function t(t){return e.map(e=>{if(e.enable)return e.block_id}).includes(t)}return{handler:function(t){e=t},includes_enable:t,update:function(t){e=t},wait_view:function(e){t(e)&&postMessage({type:"breakpoint_wait_view",data:e})},reset_view:function(e){t(e)&&postMessage({type:"breakpoint_reset_view",data:e})}}}(),n.dispatcher.breakpoint=n.Blockly_Debuggee.actions.breakpoint.handler,n.Blockly_Debuggee.actions.runToCursor={cursorBreakpoint:"",handler:function(e){n.Blockly_Debuggee.actions.runToCursor.cursorBreakpoint=e,n.Blockly_Debuggee.state.stepWait=!0}},n.dispatcher.runToCursor=n.Blockly_Debuggee.actions.runToCursor.handler}n.Blockly_Debuggee.actions.watch={},n.Blockly_Debuggee.actions.variables={},n.Blockly_Debuggee.actions.eval={},a.d(t,"BlocklyDebuggee",function(){return o}),onmessage=function(e){let t=e.data;n.dispatcher[t.type](t.data)},o({postMessage:postMessage})}]);
//# sourceMappingURL=debuggee.js.map